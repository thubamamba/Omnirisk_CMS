<% content_for :section_title, "Active Storage" %>

<p class="text-xl">Active Storage provides file uploads for Rails applications and is the storage mechanism for Action Text, Action Mailbox, and more.</p>

<%= h2_with_anchor "Using Active Storage" %>
<p>Active Storage is installed by default in Jumpstart Pro.</p>
<p>Check out the <%= link_to "GoRails screencast episodes on Active Storage", "https://gorails.com/episodes/tagged/ActiveStorage", target: :_blank, class: "text-primary-500" %> and the <%= link_to "Active Storage Rails Guide", "https://edgeguides.rubyonrails.org/active_storage_overview.html", target: :_blank, class: "text-primary-500" %> for more information on how to use Active Storage.</p>
<p>For production, we <strong>strongly</strong> recommend using a CDN for serving files. Active Storage processes images through Rails which can add unncessary load to your Rails application and slow down your app if you don't have a CDN in production.</p>

<%= h2_with_anchor "Direct Uploads" %>
<p>Add <code>direct_upload: true</code> to a <code>file_field</code> to enable direct uploads with ActiveStorage.</p>
<div class="not-prose">
  <pre><code>&lt;%= form.file_field :attachments, multiple: true, direct_upload: true %&gt;</code></pre>
</div>
<p>The Trix editor is also preconfigured to use direct uploads when uploading attachments.</p>

<%= h2_with_anchor "User Avatars" %>
<p>Users have default avatars using Gravatar, but they may override this by uploading their own avatar. These avatars are uploaded and processed using Active Storage.</p>

<%= h2_with_anchor "Orphaned Uploads" %>
<p>Sometimes a user might upload a file but close the tab leaving an orphaned file in storage. To clean these up, we need to run a cron job regularly to purge any unattached blobs from ActiveStorage.</p>
<p>Jumpstart Pro comes with a Rake task you can run nightly to purge any orphaned, unattached blobs. Simply add this to cron or as a scheduled job:</p>
<div class="not-prose">
  <pre><code>rails active_storage:cleanup</code></pre>
</div>
